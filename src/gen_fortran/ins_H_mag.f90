H_mag(1,1) = 0
H_mag(1,2) = -(cos(%psi)*sin(%theta)*Bn+sin(%psi)*sin(%theta)*Be+cos(%theta)*Bd)
H_mag(1,3) = -cos(%theta)*(sin(%psi)*Bn-cos(%psi)*Be)
H_mag(1,4) = 0
H_mag(1,5) = 0
H_mag(1,6) = 0
H_mag(1,7) = 0
H_mag(1,8) = 0
H_mag(1,9) = 0
H_mag(2,1) = cos(%phi)*cos(%psi)*sin(%theta)*Bn+sin(%phi)*sin(%psi)*Bn+cos(%phi)*sin(%psi)*sin(%theta)*Be-sin(%phi)*cos(%psi)*Be+cos(%phi)*cos(%theta)*Bd
H_mag(2,2) = sin(%phi)*(cos(%psi)*cos(%theta)*Bn+sin(%psi)*cos(%theta)*Be-sin(%theta)*Bd)
H_mag(2,3) = -(sin(%phi)*sin(%psi)*sin(%theta)*Bn+cos(%phi)*cos(%psi)*Bn-sin(%phi)*cos(%psi)*sin(%theta)*Be+cos(%phi)*sin(%psi)*Be)
H_mag(2,4) = 0
H_mag(2,5) = 0
H_mag(2,6) = 0
H_mag(2,7) = 0
H_mag(2,8) = 0
H_mag(2,9) = 0
H_mag(3,1) = -(sin(%phi)*cos(%psi)*sin(%theta)*Bn-cos(%phi)*sin(%psi)*Bn+sin(%phi)*sin(%psi)*sin(%theta)*Be+cos(%phi)*cos(%psi)*Be+sin(%phi)*cos(%theta)*Bd)
H_mag(3,2) = cos(%phi)*(cos(%psi)*cos(%theta)*Bn+sin(%psi)*cos(%theta)*Be-sin(%theta)*Bd)
H_mag(3,3) = -(cos(%phi)*sin(%psi)*sin(%theta)*Bn-sin(%phi)*cos(%psi)*Bn-cos(%phi)*cos(%psi)*sin(%theta)*Be-sin(%phi)*sin(%psi)*Be)
H_mag(3,4) = 0
H_mag(3,5) = 0
H_mag(3,6) = 0
H_mag(3,7) = 0
H_mag(3,8) = 0
H_mag(3,9) = 0
